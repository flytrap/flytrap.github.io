#+TITLE: Docker 常用命令, 运行使用postgresql
#+DATE: <2017-07-22>
#+TAGS: docker,linux,postgresql
#+CATEGORIES: tech

* docker postgresql 使用
** Summary
docker的常用命令介绍，以及使用docker运行postgresql数据库

** docker install
略 ...

** pull docker images
#+begin_src bash
docker search postgresql
info
NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
postgres                          The PostgreSQL object-relational database ...   3773      [OK]
// 选择一个最多的
docker pull postgres  # 拉取远程镜像
#+end_src

#+begin_html
<!--more-->
#+end_html

** run docker
#+begin_src bash
docker run --name ps_taiga -e POSTGRES_PASSWORD=taiga -e POSTGRES_USER=taiga -v /Users/admin/code/media/data/postgresql:/var/lib/postgresql --restart always -d -p 5432:5432 postgres

# --name docker别名
# -e 修改环境变量 POSTGRES_PASSWORD, 数据库密码，POSTGRES_USER 账号明
# -d demo
# -p 端口映射 (本地: docker容器)
# -v 磁盘映射
# --restart always 随docker一起启动
# 需要说明的是这里的磁盘/var/lib/postgresql/data目录，数据默认是放在data里面的

psql -h 127.0.0.1 -U taiga  #  进去试着创建一个数据库试试

＃redis docker
docker run -p 6379:6379 --name flytrap_redis --restart always -d redis


#+end_src

** 一些常用命令

#+begin_src bash
docker images  ＃ 显示本地镜像列表
docker stop ps_taiga  # 停止运行容器
docker start ps_taiga  # 启动容器
docker exec -it ps_taiga /bin/bash  # 交互模式运行容器的bash, 做一些操作
#+end_src

* 例子
** 安装mysql
开机自动启动 --restart always

设置root密码 -e MYSQL\_ROOT\_PASSWORD=root  # _需要转义
#+begin_src bash
docker search mysql
docker pull mysql
docker run --name mysql1 -p 3306:3306 -e MYSQL\_ROOT\_PASSWORD=root -v /home/flytrap/data/mysql:/var/lib/mysql --restart always -d mysql
#+end_src

* 普通用户添加操作权限
#+begin_src bash
docker ps  # 报错
Got permission denied while trying to connect to the Docker daemon socket ...
# 添加普通用户权限
sudo groupadd docker  # 添加docker用户组,已存在，就不会添加，一般安装完docker就已经存在了
sudo gpasswd -a $USER docker  # 将登陆用户加入到docker用户组中
newgrp docker  # 更新用户组
docker ps  # 测试一下
#+end_src
